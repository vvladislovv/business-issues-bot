# Telegram Survey Bot

Telegram бот для проведения опросов с административной панелью, системой рассылок и анализом возрастных категорий для определения доступных субсидий.

## Функциональность

### Основные возможности
- Проведение опросов с сохранением результатов
- Анализ возрастных категорий для определения доступных субсидий:
  - До 25 лет: доступны соц. контракт (350.000₽) и грант (500.000₽)
  - От 25 лет: доступен соц. контракт (350.000₽)
- Административная панель с защитой паролем
- Статистика использования (день/неделя/месяц)
- Выгрузка данных в Excel
- Система рассылок (текст/фото/видео)
- Поддержка кнопок и форматирования в сообщениях

### Опросы
- Многоступенчатая система вопросов
- Адаптивные рекомендации на основе ответов
- Сохранение и анализ результатов
- Автоматическая генерация отчетов

### Административные функции
- Просмотр статистики активности
- Выгрузка данных пользователей
- Управление рассылками
- Мониторинг использования бота

## Установка

### Стандартная установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd <repository-name>
```

2. Создайте виртуальное окружение и установите зависимости:
```bash
python -m venv .venv
source .venv/bin/activate  # для Linux/Mac
# или
.venv\Scripts\activate  # для Windows
pip install -r requirements.txt
```

3. Создайте файл `.env` в корневой директории проекта:
```env
# Telegram Bot settings
TOKEN_BOT=your_bot_token
ADMIN_PASSWORD=your_admin_password
CHANNEL_ID=your_channel_id

# Database settings
MYSQL_ROOT_PASSWORD=your_root_password
MYSQL_DATABASE=survey_db
MYSQL_USER=survey_user
MYSQL_PASSWORD=survey_password
DATABASE_URL=mysql://${MYSQL_USER}:${MYSQL_PASSWORD}@db/${MYSQL_DATABASE}

# Admin settings
ADMINS=["123456789"]  # ID администраторов через запятую
```

### Установка через Docker

1. Убедитесь, что у вас установлены Docker и Docker Compose

2. Создайте файл `.env` как описано выше

3. Запустите контейнеры:
```bash
docker-compose up -d
```

## Структура проекта

```
├── src/
│   ├── config/         # Конфигурация бота
│   ├── database/       # Работа с базой данных
│   ├── handlers/       # Обработчики команд
│   ├── keyboards/      # Клавиатуры и кнопки
│   └── utils/          # Вспомогательные функции
├── .env                # Переменные окружения
├── Dockerfile         # Конфигурация Docker
├── docker-compose.yml # Конфигурация Docker Compose
├── requirements.txt   # Зависимости проекта
└── main.py           # Точка входа
```

## Использование

### Команды бота
- `/start` - Начать работу с ботом
- `/admin` - Доступ к панели администратора (требуется пароль)

### Административная панель
После авторизации доступны функции:
- Просмотр статистики активности
- Выгрузка данных пользователей в Excel
- Создание и отправка рассылок
- Мониторинг использования бота

## База данных

### Структура базы данных
- `users` - Информация о пользователях
- `user_surveys` - Ответы на опросы
- `user_activity` - Статистика активности

### Таблицы
- `users`: информация о пользователях, их активности и статусе
- `user_surveys`: ответы пользователей на опросы
- `user_activity`: статистика использования по дням/неделям/месяцам

## Разработка

### Технологии
- Python 3.11
- aiogram 3.x
- SQLAlchemy
- MySQL
- pandas
- Docker

### Локальная разработка
```bash
# Запуск базы данных
docker-compose up db -d

# Запуск бота локально
python main.py
```

### Docker разработка
```bash
# Сборка и запуск всех сервисов
docker-compose up --build -d

# Просмотр логов
docker-compose logs -f

# Остановка сервисов
docker-compose down
```

